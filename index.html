<!doctype html>
<html lang="en">
  <head>
    <!-- Basic Meta -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Instagram Downloader - Download Photos & Videos Online | Premium Edition
    </title>
    <meta
      name="description"
      content="Download Instagram photos, reels, and videos instantly online. Premium Instagram downloader with fast, secure, and free service. Works on mobile and desktop."
    />
    <meta
      name="keywords"
      content="Instagram downloader, download Instagram photos, download Instagram videos, Instagram reels download, free Instagram download, Instagram video saver, Instagram photo saver, IG downloader, Insta download, download from Instagram, Instagram media downloader, Instagram content downloader, save Instagram posts, Instagram post downloader, Instagram story downloader, download Instagram stories, Instagram highlights download, save Instagram highlights, Instagram profile downloader, download Instagram profile pictures, IG profile picture download, Instagram avatar downloader, Instagram carousel download, download Instagram albums, Instagram multiple photos download, Instagram gallery downloader, Instagram HD download, download high quality Instagram, Instagram 4K download, Instagram video download in HD, Instagram photo download HD, free Instagram video downloader, online Instagram downloader, Instagram downloader without login, Instagram downloader no signup, Instagram downloader private, Instagram downloader anonymous, Instagram downloader tool, Instagram downloader app, Instagram downloader website, Instagram downloader online free, Instagram downloader 2024, Instagram downloader latest, Instagram downloader fast, Instagram downloader instant, Instagram reels saver, Instagram reels video download, download Instagram reels video, save Instagram reels, Instagram video download online, Instagram photo download online, Instagram media saver, Instagram content saver, Instagram post saver, Instagram story saver, Instagram highlights saver, Instagram profile picture saver, Instagram avatar saver, Instagram carousel saver, Instagram album saver, Instagram gallery saver, Instagram HD saver, Instagram 4K saver, Instagram video saver HD, Instagram photo saver HD, free Instagram video saver, online Instagram saver, Instagram saver without login, Instagram saver no signup, Instagram saver private, Instagram saver anonymous, Instagram saver tool, Instagram saver app, Instagram saver website, Instagram saver online free, Instagram saver 2024, Instagram saver latest, Instagram saver fast, Instagram saver instant, Instagram reels saver, Instagram reels video saver, save Instagram reels video, Instagram video saver online, Instagram photo saver online, Instagram media extractor, Instagram content extractor, Instagram post extractor, Instagram story extractor, Instagram highlights extractor, Instagram profile picture extractor, Instagram avatar extractor, Instagram carousel extractor, Instagram album extractor, Instagram gallery extractor, Instagram HD extractor, Instagram 4K extractor, Instagram video extractor HD, Instagram photo extractor HD, free Instagram video extractor, online Instagram extractor, Instagram extractor without login, Instagram extractor no signup, Instagram extractor private, Instagram extractor anonymous, Instagram extractor tool, Instagram extractor app, Instagram extractor website, Instagram extractor online free, Instagram extractor 2024, Instagram extractor latest, Instagram extractor fast, Instagram extractor instant, Instagram reels extractor, Instagram reels video extractor, save Instagram reels video extractor, Instagram video extractor online, Instagram photo extractor online, Instagram media grabber, Instagram content grabber, Instagram post grabber, Instagram story grabber, Instagram highlights grabber, Instagram profile picture grabber, Instagram avatar grabber, Instagram carousel grabber, Instagram album grabber, Instagram gallery grabber, Instagram HD grabber, Instagram 4K grabber, Instagram video grabber HD, Instagram photo grabber HD, free Instagram video grabber, online Instagram grabber, Instagram grabber without login, Instagram grabber no signup, Instagram grabber private, Instagram grabber anonymous, Instagram grabber tool, Instagram grabber app, Instagram grabber website, Instagram grabber online free, Instagram grabber 2024, Instagram grabber latest, Instagram grabber fast, Instagram grabber instant, Instagram reels grabber, Instagram reels video grabber, save Instagram reels video grabber, Instagram video grabber online, Instagram photo grabber online"
    />
    <meta name="author" content="MOHAMMAD SAJIB" />

    <!-- Open Graph (for social sharing) -->
    <meta
      property="og:title"
      content="Instagram Downloader - Premium Edition"
    />
    <meta
      property="og:description"
      content="Download Instagram photos, reels, and videos instantly online. Fast, secure, and free."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://instagram.apaybd.com" />
    <meta
      property="og:image"
      content="https://yourdomain.com/preview-image.jpg"
    />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Instagram Downloader - Premium Edition"
    />
    <meta
      name="twitter:description"
      content="Download Instagram photos, reels, and videos instantly online. Free and fast service for mobile and desktop."
    />
    <meta
      name="twitter:image"
      content="https://yourdomain.com/preview-image.jpg"
    />

    <!-- Canonical URL -->
    <link rel="canonical" href="https://instagram.apaybd.com" />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/svg+xml"
      href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64"><rect width="64" height="64" rx="16" fill="%23E4405F"/><g><path d="M32 20 L32 40 M24 32 L32 40 L40 32" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none"/></g></svg>'
    />

    <!-- fallback -->

    <!-- Additional SEO Meta Tags -->
    <meta
      name="robots"
      content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"
    />
    <meta name="googlebot" content="index, follow" />
    <meta name="bingbot" content="index, follow" />
    <meta name="language" content="English" />
    <meta name="distribution" content="global" />
    <meta name="rating" content="general" />
    <meta name="revisit-after" content="7 days" />
    <meta name="geo.region" content="US-NY" />
    <meta name="geo.placename" content="New York" />
    <meta name="ICBM" content="40.7128, -74.0060" />

    <!-- Additional Open Graph Tags -->
    <meta property="og:site_name" content="Instagram Downloader Premium" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:updated_time" content="2026-01-030T00:00:00+00:00" />
    <meta property="article:author" content="Instagram Downloader" />
    <meta property="article:section" content="Social Media Tools" />
    <meta
      property="article:tag"
      content="Instagram, Downloader, Video, Photo, Reels"
    />

    <!-- Structured Data (JSON-LD for better SEO) -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Instagram Downloader - Premium Edition",
        "url": "https://instagram.apaybd.com",
        "description": "Download Instagram photos, videos, reels, and stories instantly with our premium downloader. Free, fast, and secure.",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "Web Browser",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "featureList": [
          "Download Instagram Videos",
          "Download Instagram Photos",
          "Download Instagram Reels",
          "Download Instagram Stories",
          "HD Quality Downloads",
          "No Login Required",
          "Free Service",
          "Fast Downloads"
        ],
        "author": {
          "@type": "Organization",
          "name": "MOHAMMAD SAJIB"
        },
        "publisher": {
          "@type": "Organization",
          "name": "Instagram Downloader"
        },
        "datePublished": "2026-01-30",
        "dateModified": "2026-01-30",
        "inLanguage": "en-US",
        "isFamilyFriendly": "true",
        "contentRating": "Everyone",
        "potentialAction": {
          "@type": "SearchAction",
          "target": "https://instagram.apaybd.com/search?q={search_term_string}",
          "query-input": "required name=search_term_string"
        }
      }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Firebase SDK -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
      import {
        getAnalytics,
        logEvent,
        setUserId,
        setUserProperties,
      } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
      import { getPerformance } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-performance.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyAi3zu-ZXp8erzkxM9nw5mZTN8Fb3mQTxA",
        authDomain: "instragram-analytics.firebaseapp.com",
        projectId: "instragram-analytics",
        storageBucket: "instragram-analytics.firebasestorage.app",
        messagingSenderId: "387153917198",
        appId: "1:387153917198:web:4de8c55f7a413ba32a535f",
        measurementId: "G-RCL4ZHXCE3",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const perf = getPerformance(app);

      // Track page visit
      logEvent(analytics, "page_view", {
        page_title: document.title,
        page_location: window.location.href,
      });

      // Get user location (approximate)
      fetch("https://ipapi.co/json/")
        .then((response) => response.json())
        .then((data) => {
          if (data && data.country && data.city) {
            setUserProperties(analytics, {
              country: data.country,
              city: data.city,
            });
          }
        })
        .catch((error) => console.error("Error getting location:", error));

      // Make analytics available globally
      window.firebaseAnalytics = analytics;
      window.logAnalyticsEvent = logEvent;
    </script>
    <style>
      /* Custom styles for premium look */
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          Oxygen,
          Ubuntu,
          sans-serif;
      }

      .glass-morphism {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
      }

      .premium-gradient {
        background: linear-gradient(120deg, #f093fb 0%, #f5576c 100%);
      }

      .premium-gradient-alt {
        background: linear-gradient(120deg, #4facfe 0%, #00f2fe 100%);
      }

      .premium-gradient-dark {
        background: linear-gradient(120deg, #30cfd0 0%, #330867 100%);
      }

      .neon-glow {
        box-shadow:
          0 0 15px rgba(79, 172, 254, 0.5),
          0 0 30px rgba(79, 172, 254, 0.3);
      }

      .neon-pink {
        box-shadow:
          0 0 15px rgba(240, 147, 251, 0.5),
          0 0 30px rgba(240, 147, 251, 0.3);
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      @keyframes slideIn {
        from {
          transform: translateX(-100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes float {
        0% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
        100% {
          transform: translateY(0px);
        }
      }

      @keyframes shimmer {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      @keyframes gradient {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      @keyframes skeleton {
        0% {
          background-position: -200% 0;
        }
        100% {
          background-position: 200% 0;
        }
      }

      .animate-fadeIn {
        animation: fadeIn 0.6s ease-out forwards;
      }

      .animate-pulse-once {
        animation: pulse 0.5s ease-in-out;
      }

      .animate-slideIn {
        animation: slideIn 0.5s ease-out forwards;
      }

      .floating {
        animation: float 3s ease-in-out infinite;
      }

      /* Loading spinner */
      .spinner {
        border-top-color: #4facfe;
        animation: spin 1s linear infinite;
      }

      /* Progress bar animation */
      .progress-bar {
        transition: width 0.3s ease;
      }

      /* Hover effects */
      .hover-lift {
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .hover-lift:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }

      /* Button animations */
      .btn-gradient {
        position: relative;
        overflow: hidden;
        z-index: 1;
      }

      .btn-gradient::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.2);
        transform: translateX(-100%);
        transition: transform 0.6s;
        z-index: -1;
      }

      .btn-gradient:hover::before {
        transform: translateX(0);
      }

      /* Premium scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(120deg, #f093fb 0%, #f5576c 100%);
        border-radius: 10px;
      }

      /* Tab styles */
      .tab-active {
        background: linear-gradient(120deg, #f093fb 0%, #f5576c 100%);
        color: white;
      }

      /* Shimmer effect */
      .shimmer {
        background: linear-gradient(
          90deg,
          #f0f0f0 25%,
          #e0e0e0 50%,
          #f0f0f0 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
      }

      /* Animated gradient background */
      .animated-gradient {
        background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
      }

      /* Card hover effects */
      .card-hover {
        transition: all 0.3s ease;
      }

      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      /* Notification styles */
      .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 10px;
        color: white;
        font-weight: 500;
        z-index: 1000;
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.3s ease;
      }

      .notification.show {
        transform: translateY(0);
        opacity: 1;
      }

      .notification.success {
        background: linear-gradient(120deg, #56ab2f 0%, #a8e063 100%);
      }

      .notification.error {
        background: linear-gradient(120deg, #ff416c 0%, #ff4b2b 100%);
      }

      /* Video player custom controls */
      .video-container {
        position: relative;
        overflow: hidden;
        border-radius: 12px;
        background: #000;
      }

      .video-wrapper {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 aspect ratio */
        height: 0;
        overflow: hidden;
      }

      .video-player {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .video-controls {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
        padding: 15px;
        display: flex;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .video-container:hover .video-controls,
      .video-controls.show {
        opacity: 1;
      }

      .video-progress {
        flex-grow: 1;
        height: 5px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 5px;
        margin: 0 15px;
        cursor: pointer;
        position: relative;
      }

      .video-progress-filled {
        height: 100%;
        background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
        border-radius: 5px;
        width: 0%;
        position: relative;
      }

      .video-progress-filled::after {
        content: "";
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 12px;
        height: 12px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      }

      .video-time {
        color: white;
        font-size: 12px;
        min-width: 80px;
        text-align: center;
      }

      .video-button {
        background: none;
        border: none;
        color: white;
        font-size: 18px;
        margin-right: 10px;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .video-button:hover {
        transform: scale(1.2);
      }

      .video-button:active {
        transform: scale(0.9);
      }

      .video-volume {
        display: flex;
        align-items: center;
      }

      .volume-slider {
        width: 80px;
        margin-left: 10px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .video-volume:hover .volume-slider {
        opacity: 1;
      }

      .video-download-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(255, 255, 255, 0.9);
        color: #764ba2;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 10;
      }

      .video-container:hover .video-download-btn {
        opacity: 1;
      }

      .video-download-btn:hover {
        background: white;
        transform: scale(1.1);
      }

      /* Skeleton loading styles */
      .skeleton {
        background: linear-gradient(
          90deg,
          #f0f0f0 25%,
          #e0e0e0 50%,
          #f0f0f0 75%
        );
        background-size: 200% 100%;
        animation: skeleton 1.5s infinite;
      }

      .skeleton-text {
        height: 1rem;
        margin-bottom: 0.5rem;
        border-radius: 4px;
      }

      .skeleton-title {
        height: 1.5rem;
        width: 60%;
        margin-bottom: 1rem;
        border-radius: 4px;
      }

      .skeleton-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
      }

      .skeleton-media {
        height: 300px;
        border-radius: 8px;
        margin-bottom: 1rem;
      }

      .skeleton-comment {
        height: 1rem;
        margin-bottom: 0.5rem;
        border-radius: 4px;
      }

      .skeleton-button {
        height: 40px;
        width: 120px;
        border-radius: 20px;
      }

      /* Custom input focus styles */
      .custom-input:focus {
        box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.3);
      }

      /* Feature cards */
      .feature-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 20px;
        transition: all 0.3s ease;
      }

      .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
      }

      /* Stats counter */
      .stat-counter {
        font-size: 2rem;
        font-weight: bold;
        background: linear-gradient(120deg, #f093fb 0%, #f5576c 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      /* Download progress styles */
      .download-progress {
        position: fixed;
        bottom: 20px;
        left: 20px;
        right: 20px;
        max-width: 500px;
        margin: 0 auto;
        z-index: 1000;
      }

      /* Image loading animation */
      .image-loading {
        background: linear-gradient(
          90deg,
          #f0f0f0 25%,
          #e0e0e0 50%,
          #f0f0f0 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
        border-radius: 8px;
      }
    </style>
  </head>
  <body class="animated-gradient min-h-screen">
    <!-- Notification Container -->
    <div id="notification" class="notification"></div>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
      <!-- Header -->
      <header class="text-center mb-10 animate-fadeIn">
        <div
          class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-white shadow-2xl mb-6 floating neon-glow"
        >
          <i
            class="fab fa-instagram text-4xl text-gradient bg-gradient-to-r from-purple-600 to-pink-500 bg-clip-text text-transparent"
          ></i>
        </div>
        <h1 class="text-5xl md:text-6xl font-bold text-white mb-3">
          Instagram Downloader
        </h1>
        <p class="text-white/90 text-xl max-w-2xl mx-auto">
          Download high-quality Instagram content with our premium downloader
        </p>

        <!-- Feature Pills -->
        <div class="flex flex-wrap justify-center gap-3 mt-6">
          <span
            class="px-4 py-2 bg-white/20 backdrop-blur-md rounded-full text-white text-sm font-medium"
          >
            <i class="fas fa-check-circle mr-1"></i> HD Quality
          </span>
          <span
            class="px-4 py-2 bg-white/20 backdrop-blur-md rounded-full text-white text-sm font-medium"
          >
            <i class="fas fa-bolt mr-1"></i> Fast Download
          </span>
          <span
            class="px-4 py-2 bg-white/20 backdrop-blur-md rounded-full text-white text-sm font-medium"
          >
            <i class="fas fa-shield-alt mr-1"></i> Secure & Private
          </span>
        </div>
      </header>

      <!-- Main Card -->
      <main
        class="glass-morphism rounded-2xl shadow-2xl overflow-hidden animate-fadeIn"
        style="animation-delay: 0.2s"
      >
        <!-- Search Section -->
        <section class="p-6 md:p-8">
          <div class="flex flex-col md:flex-row gap-4">
            <div class="relative flex-1">
              <input
                type="text"
                id="urlInput"
                placeholder="Paste Instagram post URL here..."
                class="w-full px-5 py-4 pr-12 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none transition-all custom-input text-lg"
              />
              <div
                class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"
              >
                <i class="fas fa-link text-xl"></i>
              </div>
            </div>
            <button
              id="searchButton"
              class="px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-500 text-white font-bold rounded-xl hover:shadow-lg transform transition-all duration-300 hover:scale-105 focus:outline-none btn-gradient neon-pink"
            >
              <i class="fas fa-search mr-2"></i>
              <span>Download</span>
            </button>
          </div>

          <!-- Tabs -->
          <div class="flex mt-6 border-b border-gray-200">
            <button
              class="tab-btn px-4 py-2 font-medium rounded-t-lg transition-all tab-active"
              data-tab="all"
            >
              <i class="fas fa-th mr-2"></i>All Media
            </button>
            <button
              class="tab-btn px-4 py-2 font-medium rounded-t-lg transition-all"
              data-tab="video"
            >
              <i class="fas fa-video mr-2"></i>Videos
            </button>
            <button
              class="tab-btn px-4 py-2 font-medium rounded-t-lg transition-all"
              data-tab="image"
            >
              <i class="fas fa-image mr-2"></i>Images
            </button>
          </div>
        </section>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="p-8 text-center hidden">
          <div
            class="inline-block w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full spinner mb-4"
          ></div>
          <p class="text-gray-600 text-lg">Fetching post data...</p>
          <div
            class="w-64 h-2 bg-gray-200 rounded-full mx-auto mt-4 overflow-hidden"
          >
            <div
              class="h-full bg-gradient-to-r from-purple-600 to-pink-500 rounded-full shimmer"
              style="width: 100%"
            ></div>
          </div>
        </div>

        <!-- Skeleton Loading State -->
        <div id="skeletonLoader" class="p-6 md:p-8 hidden">
          <!-- Post Info Skeleton -->
          <div class="mb-8 pb-6 border-b border-gray-200">
            <div class="flex items-center gap-4 mb-4">
              <div class="skeleton skeleton-avatar"></div>
              <div class="flex-1">
                <div class="skeleton skeleton-title"></div>
                <div class="skeleton skeleton-text" style="width: 40%"></div>
              </div>
            </div>

            <div class="flex gap-6 mb-4">
              <div class="skeleton skeleton-text" style="width: 80px"></div>
              <div class="skeleton skeleton-text" style="width: 80px"></div>
              <div class="skeleton skeleton-text" style="width: 100px"></div>
            </div>

            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text" style="width: 90%"></div>
            <div class="skeleton skeleton-text" style="width: 70%"></div>
          </div>

          <!-- Media Grid Skeleton -->
          <div class="mb-8 pb-6 border-b border-gray-200">
            <div class="skeleton skeleton-title mb-4"></div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="skeleton skeleton-media"></div>
              <div class="skeleton skeleton-media"></div>
            </div>
          </div>

          <!-- Comments Section Skeleton -->
          <div>
            <div class="skeleton skeleton-title mb-4"></div>
            <div class="space-y-4">
              <div class="bg-gray-50 p-4 rounded-lg">
                <div
                  class="skeleton skeleton-text mb-2"
                  style="width: 30%"
                ></div>
                <div class="skeleton skeleton-text"></div>
                <div class="skeleton skeleton-text" style="width: 80%"></div>
              </div>
              <div class="bg-gray-50 p-4 rounded-lg">
                <div
                  class="skeleton skeleton-text mb-2"
                  style="width: 25%"
                ></div>
                <div class="skeleton skeleton-text"></div>
                <div class="skeleton skeleton-text" style="width: 90%"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Error Message -->
        <div
          id="errorMessage"
          class="m-6 p-6 bg-red-50 text-red-700 rounded-xl hidden animate-fadeIn"
        >
          <div class="flex items-start">
            <div class="flex-shrink-0">
              <i class="fas fa-exclamation-circle text-2xl"></i>
            </div>
            <div class="ml-3">
              <h3 class="text-lg font-medium">Error</h3>
              <p id="errorText" class="mt-1"></p>
            </div>
          </div>
        </div>

        <!-- Post Content -->
        <div id="postContent" class="p-6 md:p-8 hidden">
          <!-- Post Info -->
          <div class="mb-8 pb-6 border-b border-gray-200">
            <div class="flex items-center gap-4 mb-4">
              <div
                class="w-14 h-14 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 flex items-center justify-center text-white font-bold text-xl shadow-lg"
              >
                <span id="ownerAvatar"></span>
              </div>
              <div>
                <div class="flex items-center gap-2">
                  <h2 id="ownerName" class="text-xl font-bold"></h2>
                  <span
                    id="verifiedBadge"
                    class="hidden flex items-center justify-center w-6 h-6 bg-blue-500 text-white rounded-full text-xs font-bold"
                  >
                    <i class="fas fa-check"></i>
                  </span>
                </div>
                <span id="ownerUsername" class="text-gray-600"></span>
              </div>
            </div>

            <div class="flex gap-6 mb-4">
              <div class="flex items-center gap-2">
                <i class="fas fa-heart text-red-500"></i>
                <span id="likesCount" class="font-medium"></span>
              </div>
              <div class="flex items-center gap-2">
                <i class="fas fa-comment text-blue-500"></i>
                <span id="commentsCount" class="font-medium"></span>
              </div>
              <div class="flex items-center gap-2">
                <i class="fas fa-calendar text-gray-500"></i>
                <span id="postDate" class="font-medium"></span>
              </div>
            </div>

            <p id="caption" class="text-gray-800 whitespace-pre-line"></p>
          </div>

          <!-- Media Grid -->
          <div class="mb-8 pb-6 border-b border-gray-200">
            <h3 class="text-xl font-bold mb-4 flex items-center">
              <i class="fas fa-photo-video mr-2 text-purple-600"></i>
              Media Content
            </h3>
            <div
              id="mediaGrid"
              class="grid grid-cols-1 md:grid-cols-2 gap-6"
            ></div>
          </div>

          <!-- Comments Section -->
          <div>
            <h3 class="text-xl font-bold mb-4 flex items-center">
              <i class="fas fa-comments mr-2 text-purple-600"></i>
              Comments
            </h3>
            <div id="commentsList" class="space-y-4"></div>
          </div>
        </div>
      </main>

      <!-- Features Section -->
      <section
        class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6 animate-fadeIn"
        style="animation-delay: 0.4s"
      >
        <div class="feature-card">
          <div
            class="w-12 h-12 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 flex items-center justify-center text-white mb-4"
          >
            <i class="fas fa-download"></i>
          </div>
          <h3 class="text-lg font-bold mb-2">Direct Downloads</h3>
          <p class="text-gray-600">
            Download Instagram content directly without any redirects or
            watermarks.
          </p>
        </div>

        <div class="feature-card">
          <div
            class="w-12 h-12 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 flex items-center justify-center text-white mb-4"
          >
            <i class="fas fa-lock"></i>
          </div>
          <h3 class="text-lg font-bold mb-2">Privacy First</h3>
          <p class="text-gray-600">
            Your downloads are private. We don't store any of your data or
            download history.
          </p>
        </div>

        <div class="feature-card">
          <div
            class="w-12 h-12 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 flex items-center justify-center text-white mb-4"
          >
            <i class="fas fa-rocket"></i>
          </div>
          <h3 class="text-lg font-bold mb-2">Lightning Fast</h3>
          <p class="text-gray-600">
            Our optimized servers ensure your downloads are completed in
            seconds.
          </p>
        </div>
      </section>

      <!-- Footer -->
      <footer
        class="mt-12 text-center text-white/80 text-sm animate-fadeIn"
        style="animation-delay: 0.6s"
      >
        <p>
          Â© <span id="currentYear"></span> Instagram Downloader Premium. All
          rights reserved.
        </p>
        <p class="mt-2">
          Made with <i class="fas fa-heart text-red-400"></i> for Instagram
          lovers
        </p>
        <p class="mt-1">
          Developed by
          <a href="https://t.me/Enough2005" target="_blank" class="underline"
            >@Enough2005</a
          >
        </p>
      </footer>

      <script>
        // Auto-update year
        document.getElementById("currentYear").textContent =
          new Date().getFullYear();
      </script>
    </div>

    <!-- Download Progress Modal -->
    <div
      id="downloadProgressModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div
        class="glass-morphism rounded-2xl p-6 max-w-md w-full mx-4 animate-fadeIn"
      >
        <div class="flex items-center mb-4">
          <div
            class="w-12 h-12 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 flex items-center justify-center text-white mr-4"
          >
            <i class="fas fa-download"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold">Downloading Media</h3>
            <p id="downloadStatus" class="text-sm text-gray-600">
              Preparing download...
            </p>
          </div>
        </div>

        <div class="mb-4">
          <div class="flex justify-between mb-1">
            <span class="text-sm text-gray-600">Progress</span>
            <span id="downloadPercent" class="text-sm font-medium">0%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
            <div
              id="progressBar"
              class="h-full bg-gradient-to-r from-purple-600 to-pink-500 rounded-full progress-bar"
              style="width: 0%"
            ></div>
          </div>
        </div>

        <div class="flex justify-end">
          <button
            id="cancelDownload"
            class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors font-medium"
          >
            <i class="fas fa-times mr-2"></i>Cancel
          </button>
        </div>
      </div>
    </div>

    <script>
      // DOM Elements
      const urlInput = document.getElementById("urlInput");
      const searchButton = document.getElementById("searchButton");
      const loadingIndicator = document.getElementById("loadingIndicator");
      const skeletonLoader = document.getElementById("skeletonLoader");
      const errorMessage = document.getElementById("errorMessage");
      const errorText = document.getElementById("errorText");
      const postContent = document.getElementById("postContent");

      // Download progress elements
      const downloadProgressModal = document.getElementById(
        "downloadProgressModal",
      );
      const downloadStatus = document.getElementById("downloadStatus");
      const downloadPercent = document.getElementById("downloadPercent");
      const progressBar = document.getElementById("progressBar");
      const cancelDownload = document.getElementById("cancelDownload");

      // Post info elements
      const ownerName = document.getElementById("ownerName");
      const ownerAvatar = document.getElementById("ownerAvatar");
      const verifiedBadge = document.getElementById("verifiedBadge");
      const ownerUsername = document.getElementById("ownerUsername");
      const likesCount = document.getElementById("likesCount");
      const commentsCount = document.getElementById("commentsCount");
      const postDate = document.getElementById("postDate");
      const caption = document.getElementById("caption");

      // Content containers
      const mediaGrid = document.getElementById("mediaGrid");
      const commentsList = document.getElementById("commentsList");

      // Tab elements
      const tabButtons = document.querySelectorAll(".tab-btn");
      let activeTab = "all";

      // API Configuration
      const API_BASE_URL = window.origin; // Change if backend is hosted elsewhere

      // Track download controller for cancellation
      let downloadController = null;
      let currentMediaData = null;

      // Analytics tracking
      let videoPlayCount = 0;
      let videoWatchTime = 0;
      let currentVideoStartTime = null;
      let searchCount = 0;
      let videoDownloadCount = 0;
      let imageDownloadCount = 0;

      // Event Listeners
      searchButton.addEventListener("click", handleSearch);
      urlInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") handleSearch();
      });

      cancelDownload.addEventListener("click", () => {
        if (downloadController) {
          downloadController.abort();
          downloadController = null;
          hideDownloadProgress();
        }
      });

      // Tab switching
      tabButtons.forEach((button) => {
        button.addEventListener("click", () => {
          const tab = button.getAttribute("data-tab");
          activeTab = tab;

          // Update active tab styling
          tabButtons.forEach((btn) => {
            if (btn.getAttribute("data-tab") === tab) {
              btn.classList.add("tab-active");
            } else {
              btn.classList.remove("tab-active");
            }
          });

          // Filter media if data is available
          if (currentMediaData) {
            filterAndDisplayMedia(currentMediaData);
          }
        });
      });

      // Show notification
      function showNotification(message, type = "success") {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.classList.add("show");

        setTimeout(() => {
          notification.classList.remove("show");
        }, 3000);
      }

      // Track analytics event
      function trackAnalytics(eventName, parameters = {}) {
        if (window.logAnalyticsEvent && window.firebaseAnalytics) {
          window.logAnalyticsEvent(
            window.firebaseAnalytics,
            eventName,
            parameters,
          );
          console.log(`Analytics event tracked: ${eventName}`, parameters);
        }
      }

      // Helper function to get file extension from URL or content type
      function getFileExtension(url, contentType) {
        // Try to get extension from URL
        const urlParts = url.split("?")[0].split(".");
        if (urlParts.length > 1) {
          const ext = urlParts[urlParts.length - 1].toLowerCase();
          if (
            ["jpg", "jpeg", "png", "gif", "mp4", "mov", "webm"].includes(ext)
          ) {
            return ext;
          }
        }

        // Try to get extension from content type
        if (contentType) {
          if (contentType.includes("jpeg") || contentType.includes("jpg"))
            return "jpg";
          if (contentType.includes("png")) return "png";
          if (contentType.includes("gif")) return "gif";
          if (contentType.includes("mp4")) return "mp4";
          if (contentType.includes("quicktime")) return "mov";
          if (contentType.includes("webm")) return "webm";
        }

        // Default extensions based on media type
        return contentType?.includes("video") ? "mp4" : "jpg";
      }

      // Helper function to get filename from URL
      function getFilenameFromUrl(url) {
        try {
          const urlParts = url.split("/");
          const lastPart = urlParts[urlParts.length - 1];
          const filenameParts = lastPart.split("?")[0].split(".");
          if (filenameParts.length > 1) {
            // remove query params if any and return base name (without extension)
            return filenameParts.slice(0, -1).join(".") || "instagram_media";
          }
        } catch (e) {}
        return "instagram_media";
      }

      // Show download progress modal
      function showDownloadProgress() {
        downloadProgressModal.classList.remove("hidden");
        downloadStatus.textContent = "Preparing download...";
        downloadPercent.textContent = "0%";
        progressBar.style.width = "0%";
      }

      // Hide download progress modal
      function hideDownloadProgress() {
        setTimeout(() => {
          downloadProgressModal.classList.add("hidden");
        }, 500);
      }

      // Update download progress
      function updateDownloadProgress(percent) {
        downloadPercent.textContent = `${percent}%`;
        progressBar.style.width = `${percent}%`;

        if (percent < 100) {
          downloadStatus.textContent = "Downloading...";
        } else {
          downloadStatus.textContent = "Processing download...";
        }
      }

      // Filter media based on active tab
      function filterAndDisplayMedia(data) {
        mediaGrid.innerHTML = "";

        let filteredMedia = data.media_details;

        if (activeTab === "video") {
          filteredMedia = data.media_details.filter(
            (media) => media.type === "video",
          );
        } else if (activeTab === "image") {
          filteredMedia = data.media_details.filter(
            (media) => media.type === "image",
          );
        }

        filteredMedia.forEach((media, index) => {
          // suggest filename using owner username + index
          media.filename_suggest = `${data.post_info.owner_username || "instagram"}-${index + 1}`;
          if (media.type === "video") {
            mediaGrid.appendChild(createVideoPlayer(media, index));
          } else {
            mediaGrid.appendChild(createImageViewer(media, index));
          }
        });
      }

      // Main search function
      async function handleSearch() {
        const url = urlInput.value.trim();
        if (!url) return;

        // Track search event
        searchCount++;
        trackAnalytics("search", {
          search_count: searchCount,
          url_type:
            url.includes("video") || url.includes("reel") ? "video" : "image",
        });

        // Reset UI
        loadingIndicator.classList.remove("hidden");
        skeletonLoader.classList.remove("hidden");
        errorMessage.classList.add("hidden");
        postContent.classList.add("hidden");
        mediaGrid.innerHTML = "";
        commentsList.innerHTML = "";

        try {
          const response = await fetch(`${API_BASE_URL}/api/instagram/post`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ url }),
          });

          if (!response.ok) {
            const txt = await response.text().catch(() => "");
            throw new Error(
              `Failed to fetch post info (${response.status}) ${txt}`,
            );
          }
          const data = await response.json();
          currentMediaData = data;

          // Hide skeleton loader after a short delay for better UX
          setTimeout(() => {
            skeletonLoader.classList.add("hidden");
          }, 800);

          // Display the data
          displayPostData(data);
          filterAndDisplayMedia(data);
          postContent.classList.remove("hidden");

          // Track successful fetch
          trackAnalytics("fetch_success", {
            media_count: data.media_details.length,
            video_count: data.media_details.filter((m) => m.type === "video")
              .length,
            image_count: data.media_details.filter((m) => m.type === "image")
              .length,
          });
        } catch (err) {
          errorText.textContent = err.message || "An error occurred";
          errorMessage.classList.remove("hidden");
          skeletonLoader.classList.add("hidden");

          // Track error
          trackAnalytics("fetch_error", {
            error_message: err.message || "Unknown error",
          });

          console.error(err);
        } finally {
          loadingIndicator.classList.add("hidden");
        }
      }

      // Download media function using server proxy
      async function downloadMedia(
        mediaUrl,
        mediaType = "video",
        suggestedName = null,
      ) {
        try {
          showDownloadProgress();

          // Get file extension
          const extension = getFileExtension(
            mediaUrl,
            mediaType === "video" ? "video/mp4" : "image/jpeg",
          );
          const filename = suggestedName
            ? `${suggestedName}.${extension}`
            : `instagram_media.${extension}`;

          // Track download start
          if (mediaType === "video") {
            videoDownloadCount++;
            trackAnalytics("video_download_start", {
              download_count: videoDownloadCount,
              filename: filename,
            });
          } else {
            imageDownloadCount++;
            trackAnalytics("image_download_start", {
              download_count: imageDownloadCount,
              filename: filename,
            });
          }

          // Create download URL with query parameters
          const downloadUrl = `${API_BASE_URL}/api/download?url=${encodeURIComponent(mediaUrl)}&filename=${encodeURIComponent(filename)}`;

          // Create a temporary link element to trigger download
          const a = document.createElement("a");
          a.href = downloadUrl;
          a.style.display = "none";
          document.body.appendChild(a);
          a.click();

          // Clean up
          setTimeout(() => {
            document.body.removeChild(a);
            hideDownloadProgress();
          }, 100);

          // Track download completion
          if (mediaType === "video") {
            trackAnalytics("video_download_complete", {
              download_count: videoDownloadCount,
              filename: filename,
            });
          } else {
            trackAnalytics("image_download_complete", {
              download_count: imageDownloadCount,
              filename: filename,
            });
          }

          // Show success notification
          showNotification(`Download started: ${filename}`);
        } catch (err) {
          console.error("Download error:", err);
          showNotification(`Failed to download: ${err.message}`, "error");
          hideDownloadProgress();

          // Track download error
          trackAnalytics("download_error", {
            media_type: mediaType,
            error_message: err.message || "Unknown error",
          });
        }
      }

      // Get streaming URL for media
      function getStreamUrl(originalUrl) {
        return `${API_BASE_URL}/api/stream?url=${encodeURIComponent(originalUrl)}`;
      }

      // Create video player element
// Create video player element
function createVideoPlayer(media, index) {
  // Main container
  const container = document.createElement("div");
  container.className =
    "bg-gray-900 rounded-xl overflow-hidden shadow-lg hover-lift animate-fadeIn card-hover";
  container.style.animationDelay = `${index * 0.1}s`;

  // Vertical aspect ratio container for Instagram reels (9:16)
  const aspectRatioContainer = document.createElement("div");
  aspectRatioContainer.className = "relative w-full";
  aspectRatioContainer.style.paddingBottom = "177.78%"; // 9:16 aspect ratio

  const videoWrapper = document.createElement("div");
  videoWrapper.className = "absolute inset-0 video-container";

  // Video element
  const video = document.createElement("video");
  video.src = getStreamUrl(media.url);
  if (media.thumbnail) video.poster = getStreamUrl(media.thumbnail);
  video.className = "w-full h-full object-cover";
  video.preload = "metadata";
  video.setAttribute("playsinline", "");
  video.setAttribute("crossorigin", "anonymous"); // Add this for better compatibility

  // Loading indicator
  const loadingIndicator = document.createElement("div");
  loadingIndicator.className =
    "absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white";
  loadingIndicator.innerHTML =
    '<i class="fas fa-spinner fa-spin text-2xl"></i>';
  loadingIndicator.style.display = "none";

  // Error message
  const errorMessage = document.createElement("div");
  errorMessage.className =
    "absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-center hidden";
  errorMessage.innerHTML = `
    <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
    <p>Failed to load video</p>
    <button class="mt-2 px-3 py-1 bg-red-600 rounded text-sm">Retry</button>
  `;

  // Controls container
  const controlsContainer = document.createElement("div");
  controlsContainer.className =
    "absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 opacity-0 transition-all duration-300 transform translate-y-0";

  // Play/pause button with animation
  const playPauseBtn = document.createElement("button");
  playPauseBtn.className =
    "absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white/20 backdrop-blur-sm rounded-full w-16 h-16 flex items-center justify-center text-white hover:bg-white/30 transition-all duration-300 hover:scale-110 active:scale-95";
  playPauseBtn.innerHTML =
    '<i class="fas fa-play text-2xl ml-1 transition-transform duration-200"></i>';

  // Progress bar with animation
  const progressBar = document.createElement("div");
  progressBar.className =
    "relative h-1 bg-gray-600 rounded-full cursor-pointer mb-2 group";

  const progressFilled = document.createElement("div");
  progressFilled.className =
    "absolute left-0 top-0 h-full bg-gradient-to-r from-red-500 to-red-600 rounded-full transition-all duration-100";
  progressBar.appendChild(progressFilled);

  // Progress handle that appears on hover
  const progressHandle = document.createElement("div");
  progressHandle.className =
    "absolute right-0 top-1/2 transform -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 scale-0 group-hover:scale-100";
  progressFilled.appendChild(progressHandle);

  // Bottom controls container
  const bottomControls = document.createElement("div");
  bottomControls.className =
    "flex items-center justify-between text-white text-xs";

  // Time display on the left with animation
  const timeDisplay = document.createElement("span");
  timeDisplay.className =
    "mr-3 font-medium transition-colors duration-200 hover:text-red-400";
  timeDisplay.textContent = "0:00 / 0:00";

  // Volume control on the right with animation
  const volumeContainer = document.createElement("div");
  volumeContainer.className = "flex items-center group";

  const volumeBtn = document.createElement("button");
  volumeBtn.className =
    "text-white hover:text-red-400 transition-all duration-200 mr-2 transform hover:scale-110 active:scale-95";
  volumeBtn.innerHTML =
    '<i class="fas fa-volume-up transition-transform duration-200"></i>';

  const volumeSlider = document.createElement("input");
  volumeSlider.type = "range";
  volumeSlider.min = "0";
  volumeSlider.max = "1";
  volumeSlider.step = "0.05";
  volumeSlider.value = "1";
  volumeSlider.className =
    "w-16 h-1 bg-gray-600 rounded-full appearance-none cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity duration-200 volume-slider";

  volumeContainer.appendChild(volumeBtn);
  volumeContainer.appendChild(volumeSlider);

  // Assemble bottom controls
  bottomControls.appendChild(timeDisplay);
  bottomControls.appendChild(volumeContainer);

  // Assemble controls
  controlsContainer.appendChild(progressBar);
  controlsContainer.appendChild(bottomControls);

  // Info bar
  const infoBar = document.createElement("div");
  infoBar.className =
    "p-3 bg-gray-800 flex items-center justify-between transition-all duration-300 hover:bg-gray-750";

  // View count on the left with animation
  const viewCount = document.createElement("div");
  viewCount.className =
    "flex items-center text-white text-sm group cursor-pointer";
  viewCount.innerHTML = `
    <i class="fas fa-eye mr-2 transition-transform duration-200 group-hover:scale-110"></i>
    <span class="font-medium transition-colors duration-200 group-hover:text-red-400">${media.video_view_count ? Number(media.video_view_count).toLocaleString() : "0"} views</span>
  `;

  // Action buttons container
  const actionButtons = document.createElement("div");
  actionButtons.className = "flex items-center space-x-2";

  // Download button with text and animation
  const downloadBtn = document.createElement("button");
  downloadBtn.className =
    "flex items-center space-x-2 text-white bg-red-600 hover:bg-red-700 transition-all duration-300 px-3 py-2 rounded-lg hover:shadow-lg transform hover:-translate-y-0.5 active:translate-y-0 active:scale-95";
  downloadBtn.setAttribute("aria-label", "Download video");
  downloadBtn.innerHTML = `
    <i class="fas fa-download transition-transform duration-200"></i>
    <span class="font-medium">Download</span>
  `;
  downloadBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    const baseName = media.filename_suggest || `instagram-reel-${index}`;
    downloadMedia(media.url, "video", baseName);

    // Add a pulse animation on click
    downloadBtn.classList.add("animate-pulse");
    setTimeout(() => {
      downloadBtn.classList.remove("animate-pulse");
    }, 600);
  });

  // Fullscreen button with animation
  const fullscreenBtn = document.createElement("button");
  fullscreenBtn.className =
    "flex items-center text-white hover:text-red-400 transition-all duration-300 p-2 rounded-lg hover:bg-white/10 transform hover:scale-110 active:scale-95";
  fullscreenBtn.setAttribute("aria-label", "Fullscreen");
  fullscreenBtn.innerHTML = `
    <i class="fas fa-expand transition-transform duration-200"></i>
  `;

  // Assemble action buttons
  actionButtons.appendChild(downloadBtn);
  actionButtons.appendChild(fullscreenBtn);

  // Assemble player
  videoWrapper.appendChild(video);
  videoWrapper.appendChild(playPauseBtn);
  videoWrapper.appendChild(controlsContainer);
  videoWrapper.appendChild(loadingIndicator);
  videoWrapper.appendChild(errorMessage);
  aspectRatioContainer.appendChild(videoWrapper);
  container.appendChild(aspectRatioContainer);

  // Add elements to info bar
  infoBar.appendChild(viewCount);
  infoBar.appendChild(actionButtons);
  container.appendChild(infoBar);

  // Video event listeners
  let playStartTime = null;
  let totalWatchTime = 0;
  let isDragging = false;
  let isLoading = false;
  let hasError = false;

  // Function to update play/pause button state
  const updatePlayPauseButton = () => {
    if (video.paused) {
      playPauseBtn.innerHTML =
        '<i class="fas fa-play text-2xl ml-1 transition-transform duration-200"></i>';
    } else {
      playPauseBtn.innerHTML =
        '<i class="fas fa-pause text-2xl transition-transform duration-200"></i>';
    }
  };

  // Function to show loading indicator
  const showLoading = () => {
    isLoading = true;
    loadingIndicator.style.display = "block";
    playPauseBtn.style.display = "none";
  };

  // Function to hide loading indicator
  const hideLoading = () => {
    isLoading = false;
    loadingIndicator.style.display = "none";
    playPauseBtn.style.display = "flex";
  };

  // Function to show error message
  const showError = () => {
    hasError = true;
    errorMessage.style.display = "block";
    playPauseBtn.style.display = "none";
    loadingIndicator.style.display = "none";
  };

  // Function to hide error message
  const hideError = () => {
    hasError = false;
    errorMessage.style.display = "none";
    playPauseBtn.style.display = "flex";
  };

  // Function to play video
  const playVideo = () => {
    if (hasError) return;
    
    const playPromise = video.play();
    if (playPromise !== undefined) {
      playPromise
        .then(() => {
          // Playback started successfully
        })
        .catch((error) => {
          console.error("Error playing video:", error);
          showError();
        });
    }
  };

  // Function to pause video
  const pauseVideo = () => {
    if (hasError) return;
    video.pause();
  };

  // Video loading events
  video.addEventListener("loadstart", () => {
    showLoading();
  });

  video.addEventListener("canplay", () => {
    hideLoading();
    hideError();
  });

  video.addEventListener("loadedmetadata", () => {
    timeDisplay.textContent = `0:00 / ${formatTime(video.duration)}`;
  });

  video.addEventListener("waiting", () => {
    showLoading();
  });

  video.addEventListener("playing", () => {
    hideLoading();
  });

  video.addEventListener("error", () => {
    showError();
  });

  video.addEventListener("timeupdate", () => {
    if (!isDragging) {
      const percent = (video.currentTime / video.duration) * 100;
      progressFilled.style.width = `${percent}%`;
      timeDisplay.textContent = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
    }
  });

  video.addEventListener("play", () => {
    updatePlayPauseButton();
    playStartTime = Date.now();
    videoPlayCount++;
    trackAnalytics("video_play", {
      play_count: videoPlayCount,
      video_index: index,
    });
  });

  video.addEventListener("pause", () => {
    updatePlayPauseButton();
    if (playStartTime) {
      totalWatchTime += Date.now() - playStartTime;
      playStartTime = null;
    }
  });

  video.addEventListener("ended", () => {
    updatePlayPauseButton();
    if (playStartTime) {
      totalWatchTime += Date.now() - playStartTime;
      playStartTime = null;
    }
    trackAnalytics("video_complete", {
      video_index: index,
      total_watch_time: Math.round(totalWatchTime / 1000),
    });
  });

  // Control event listeners
  playPauseBtn.addEventListener("click", () => {
    if (video.paused) {
      playVideo();
    } else {
      pauseVideo();
    }

    // Add bounce animation
    playPauseBtn.classList.add("animate-bounce");
    setTimeout(() => {
      playPauseBtn.classList.remove("animate-bounce");
    }, 500);
  });

  // Retry button in error message
  const retryBtn = errorMessage.querySelector("button");
  retryBtn.addEventListener("click", () => {
    hideError();
    video.load();
  });

  // Progress bar interaction
  const updateProgress = (e) => {
    const rect = progressBar.getBoundingClientRect();
    const pos = (e.clientX - rect.left) / rect.width;
    video.currentTime = pos * video.duration;
  };

  progressBar.addEventListener("mousedown", (e) => {
    isDragging = true;
    progressBar.classList.add("scale-y-150");
    updateProgress(e);
  });

  document.addEventListener("mousemove", (e) => {
    if (isDragging) updateProgress(e);
  });

  document.addEventListener("mouseup", () => {
    if (isDragging) {
      isDragging = false;
      progressBar.classList.remove("scale-y-150");
    }
  });

  // Touch support
  progressBar.addEventListener("touchstart", (e) => {
    isDragging = true;
    const touch = e.touches[0];
    updateProgress(touch);
  });

  document.addEventListener("touchmove", (e) => {
    if (isDragging) {
      const touch = e.touches[0];
      updateProgress(touch);
    }
  });

  document.addEventListener("touchend", () => {
    isDragging = false;
  });

  // Volume control with animation
  volumeBtn.addEventListener("click", () => {
    if (video.volume > 0) {
      video.volume = 0;
      volumeSlider.value = 0;
      volumeBtn.innerHTML =
        '<i class="fas fa-volume-mute transition-transform duration-200"></i>';
    } else {
      video.volume = 1;
      volumeSlider.value = 1;
      volumeBtn.innerHTML =
        '<i class="fas fa-volume-up transition-transform duration-200"></i>';
    }

    // Add rotation animation
    volumeBtn.querySelector("i").classList.add("animate-spin");
    setTimeout(() => {
      volumeBtn.querySelector("i").classList.remove("animate-spin");
    }, 300);
  });

  volumeSlider.addEventListener("input", () => {
    video.volume = volumeSlider.value;
    const icon =
      video.volume == 0
        ? "fa-volume-mute"
        : video.volume < 0.5
          ? "fa-volume-down"
          : "fa-volume-up";
    volumeBtn.innerHTML = `<i class="fas ${icon} transition-transform duration-200"></i>`;
  });

  // Fullscreen with animation
  fullscreenBtn.addEventListener("click", () => {
    if (!document.fullscreenElement) {
      videoWrapper.requestFullscreen();
      fullscreenBtn.innerHTML =
        '<i class="fas fa-compress transition-transform duration-200"></i>';
    } else {
      document.exitFullscreen();
      fullscreenBtn.innerHTML =
        '<i class="fas fa-expand transition-transform duration-200"></i>';
    }

    // Add flip animation
    fullscreenBtn.querySelector("i").classList.add("animate-flip");
    setTimeout(() => {
      fullscreenBtn.querySelector("i").classList.remove("animate-flip");
    }, 300);
  });

  // Show/hide controls with animation
  let controlsTimeout;

  const showControls = () => {
    if (isLoading || hasError) return;
    
    controlsContainer.classList.remove("opacity-0", "translate-y-2");
    controlsContainer.classList.add("opacity-100", "translate-y-0");
    playPauseBtn.classList.remove("opacity-0", "scale-90");
    playPauseBtn.classList.add("opacity-100", "scale-100");
  };

  const hideControls = () => {
    if (!video.paused || isLoading || hasError) return;
    
    controlsContainer.classList.remove("opacity-100", "translate-y-0");
    controlsContainer.classList.add("opacity-0", "translate-y-2");
    playPauseBtn.classList.remove("opacity-100", "scale-100");
    playPauseBtn.classList.add("opacity-0", "scale-90");
  };

  videoWrapper.addEventListener("mouseenter", () => {
    showControls();
    clearTimeout(controlsTimeout);
  });

  videoWrapper.addEventListener("mouseleave", () => {
    controlsTimeout = setTimeout(hideControls, 2000);
  });

  video.addEventListener("touchstart", () => {
    showControls();
    clearTimeout(controlsTimeout);
    controlsTimeout = setTimeout(hideControls, 3000);
  });

  // Keyboard shortcuts
  document.addEventListener("keydown", (e) => {
    if (!isElementInViewport(video)) return;

    switch (e.key) {
      case " ":
        e.preventDefault();
        if (video.paused) {
          playVideo();
        } else {
          pauseVideo();
        }
        break;
      case "ArrowRight":
        video.currentTime += 5;
        break;
      case "ArrowLeft":
        video.currentTime -= 5;
        break;
      case "ArrowUp":
        video.volume = Math.min(1, video.volume + 0.1);
        volumeSlider.value = video.volume;
        break;
      case "ArrowDown":
        video.volume = Math.max(0, video.volume - 0.1);
        volumeSlider.value = video.volume;
        break;
      case "f":
        fullscreenBtn.click();
        break;
      case "m":
        volumeBtn.click();
        break;
    }
  });

  return container;
}

// Helper function to check if element is in viewport
function isElementInViewport(el) {
  const rect = el.getBoundingClientRect();
  return (
    rect.top >= 0 &&
    rect.left >= 0 &&
    rect.bottom <=
      (window.innerHeight || document.documentElement.clientHeight) &&
    rect.right <=
      (window.innerWidth || document.documentElement.clientWidth)
  );
}
      // Add custom animations to your CSS
      const style = document.createElement("style");
      style.textContent = `
  @keyframes flip {
    0% { transform: rotateY(0deg); }
    100% { transform: rotateY(360deg); }
  }
  .animate-flip {
    animation: flip 0.3s ease-in-out;
  }
`;
      document.head.appendChild(style);
      // Create image viewer element
      function createImageViewer(media, index) {
        const container = document.createElement("div");
        container.className =
          "rounded-xl overflow-hidden shadow-lg relative hover-lift animate-fadeIn card-hover";
        container.style.animationDelay = `${index * 0.1}s`;

        // Create a loading placeholder
        const loadingPlaceholder = document.createElement("div");
        loadingPlaceholder.className = "w-full h-64 image-loading";
        container.appendChild(loadingPlaceholder);

        // Create the image element
        const img = document.createElement("img");
        // Use the streaming endpoint instead of direct URL
        img.src = getStreamUrl(media.url);
        img.alt = "Instagram post";
        img.className = "w-full h-auto";

        // Replace placeholder with actual image when loaded
        img.onload = () => {
          if (loadingPlaceholder.parentNode) {
            loadingPlaceholder.parentNode.replaceChild(img, loadingPlaceholder);
          }
        };

        // Handle image loading errors
        img.onerror = () => {
          if (loadingPlaceholder.parentNode) {
            loadingPlaceholder.textContent = "Failed to load image";
            loadingPlaceholder.className =
              "w-full h-64 bg-gray-200 flex items-center justify-center text-gray-500";
          }
        };

        // Download button
        const downloadBtn = document.createElement("button");
        downloadBtn.className =
          "absolute top-3 right-3 w-12 h-12 rounded-full bg-white/90 text-purple-600 flex items-center justify-center hover:bg-white transition-all duration-300 transform hover:scale-110 shadow-lg";
        downloadBtn.setAttribute("title", "Download image");
        downloadBtn.innerHTML = `
          <i class="fas fa-download"></i>
        `;
        downloadBtn.addEventListener("click", () => {
          const baseName = media.filename_suggest || `instagram-image-${index}`;
          downloadMedia(media.url, "image", baseName);
        });

        container.appendChild(downloadBtn);

        return container;
      }

      // Format time helper function
      function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        seconds = Math.floor(seconds % 60);
        return `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
      }

      // Display post data
      function displayPostData(data) {
        try {
          // Set owner avatar (first letter of username)
          const username = data.post_info.owner_username || "";
          ownerAvatar.textContent = username.charAt(0).toUpperCase();

          ownerName.textContent = data.post_info.owner_fullname || "";
          ownerUsername.textContent = `@${username}`;
          likesCount.textContent = data.post_info.likes
            ? Number(data.post_info.likes).toLocaleString()
            : "0";
          commentsCount.textContent = data.post_info.comments_count || 0;

          // Set a placeholder date (since we don't have it in the API response)
          postDate.textContent = new Date().toLocaleDateString();

          caption.textContent = data.post_info.caption || "";

          if (data.post_info.is_verified) {
            verifiedBadge.classList.remove("hidden");
          } else {
            verifiedBadge.classList.add("hidden");
          }

          // Display comments
          (data.comments || []).forEach((comment, index) => {
            const commentEl = document.createElement("div");
            commentEl.className =
              "bg-gray-50 p-4 rounded-lg hover-lift animate-fadeIn card-hover";
            commentEl.style.animationDelay = `${index * 0.1}s`;

            const commentHeader = document.createElement("div");
            commentHeader.className = "flex justify-between items-center mb-2";

            const username = document.createElement("span");
            username.className = "font-bold text-purple-600";
            username.textContent = comment.username;

            const date = document.createElement("span");
            date.className = "text-sm text-gray-500";
            date.textContent = new Date(
              comment.created_at,
            ).toLocaleDateString();

            const text = document.createElement("p");
            text.className = "text-gray-800";
            text.textContent = comment.text;

            commentHeader.appendChild(username);
            commentHeader.appendChild(date);
            commentEl.appendChild(commentHeader);
            commentEl.appendChild(text);
            commentsList.appendChild(commentEl);
          });
        } catch (e) {
          console.error("displayPostData error", e);
        }
      }

      // Track page unload to capture final analytics
      window.addEventListener("beforeunload", () => {
        trackAnalytics("session_end", {
          search_count: searchCount,
          video_download_count: videoDownloadCount,
          image_download_count: imageDownloadCount,
          video_play_count: videoPlayCount,
          total_watch_time: Math.round(videoWatchTime / 1000), // in seconds
        });
      });
    </script>
  </body>
</html>
